<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pentest Notebook | Methodology Guide</title>
    <link rel="stylesheet" href="../css/styles.css">
    <script src="https://cdn.jsdelivr.net/npm/particles.js"></script>
    <style>
        /* Tool-Specific Styles */
        .canvas-container {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin-top: 2rem;
            overflow-x: auto;
            min-height: 60vh;
            padding-bottom: 2rem;
        }

        .kill-chain-phase {
            background: rgba(10, 10, 10, 0.8);
            border: 1px solid var(--accent-primary);
            border-radius: 8px;
            padding: 10px;
            display: flex;
            flex-direction: column;
            min-width: 220px;
            transition: all 0.3s ease;
        }

        .phase-header {
            text-align: center;
            font-size: 0.95rem;
            color: var(--accent-secondary);
            margin-bottom: 1rem;
            text-transform: uppercase;
            font-weight: bold;
            border-bottom: 1px solid #333;
            padding-bottom: 8px;
            letter-spacing: 1px;
        }

        .tactic-card {
            background: #1a1a1a;
            border: 1px solid #333;
            padding: 10px;
            margin-bottom: 8px;
            border-radius: 4px;
            cursor: grab;
            font-size: 0.8rem;
            color: #ccc;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .tactic-card:active {
            cursor: grabbing;
        }

        .tactic-card:hover {
            border-color: var(--accent-primary);
            transform: translateY(-2px);
            box-shadow: 0 0 8px rgba(0, 255, 65, 0.2);
            color: #fff;
        }

        .toolbox-area {
            background: rgba(20, 20, 20, 0.9);
            border: 1px solid #333;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 2rem;
            min-height: 100px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }

        .toolbox-label {
            width: 100%;
            margin-bottom: 10px;
            color: var(--accent-secondary);
            font-size: 0.9rem;
        }

        /* Drag Over Effect */
        .kill-chain-phase.drag-over {
            background: rgba(0, 255, 65, 0.1);
            border-color: #fff;
        }

        /* Report Modal */
        .report-output {
            background: #111;
            color: #00ff41;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid var(--accent-primary);
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            display: none;
            margin-top: 2rem;
        }
    </style>
</head>

<body class="dark-mode">
    <div id="particles-js"></div>

    <header>
        <nav>
            <ul>
                <li><a href="../index.html">/home</a></li>
                <li><a href="../about.html">/profile</a></li>
                <li><a href="../projects.html">/toolshed</a></li>
                <li><a href="../academy.html">/academy</a></li>
                <li><a href="../contact.html">/connect</a></li>
            </ul>
        </nav>
    </header>

    <main style="max-width: 1600px; width: 95%;">
        <div class="terminal-window" style="min-height: 85vh;">
            <div class="terminal-header">
                <div class="dot red"></div>
                <div class="dot yellow"></div>
                <div class="dot green"></div>
                <span style="font-size: 0.7rem; color: #555; margin-left: 10px;">./pentest_log.sh</span>
            </div>

            <div class="terminal-body">
                <h1 style="color: var(--accent-primary); margin-bottom: 0.5rem;">> PENTEST NOTEBOOK</h1>
                <p style="color: var(--text-dim); font-size: 0.9rem; margin-bottom: 2rem;">
                    [INFO] Structured workflow methodology. Drag cards to phases to log findings and generate the final
                    report.
                </p>

                <!-- Toolkit -->
                <div class="toolbox-area" id="toolbox" ondrop="drop(event)" ondragover="allowDrop(event)">
                    <div class="toolbox-label">> METHODOLOGY TOOLKIT (Drag to Log Finding)</div>
                    <!-- Draggable Items -->
                    <div class="tactic-card" draggable="true" ondragstart="drag(event)" id="card_scope"
                        data-prompt="Enter Target URL/IP Scope:">üéØ Target Scope</div>
                    <div class="tactic-card" draggable="true" ondragstart="drag(event)" id="card_recon"
                        data-prompt="Passive Recon Findings (Whois/ASN):">üîç Passive Recon</div>
                    <div class="tactic-card" draggable="true" ondragstart="drag(event)" id="card_dns"
                        data-prompt="Subdomains Found:">üåê Subdomain Enum</div>
                    <div class="tactic-card" draggable="true" ondragstart="drag(event)" id="card_nmap"
                        data-prompt="Open Ports & Services:">üì° Nmap Service Scan</div>
                    <div class="tactic-card" draggable="true" ondragstart="drag(event)" id="card_dir"
                        data-prompt="Paste Fuzzing Results (Gobuster/Dirb):">üìÇ Web Directory Fuzz</div>
                    <div class="tactic-card" draggable="true" ondragstart="drag(event)" id="card_vuln"
                        data-prompt="Describe Vulnerability/CVE:">üêõ CVE / Misconfig</div>
                    <div class="tactic-card" draggable="true" ondragstart="drag(event)" id="card_expl"
                        data-prompt="Exploit Used/Payload:">üí• Exploit Attempt</div>
                    <div class="tactic-card" draggable="true" ondragstart="drag(event)" id="card_shell"
                        data-prompt="Shell Type & Access Level:">üêö Reverse Shell / Access</div>
                    <div class="tactic-card" draggable="true" ondragstart="drag(event)" id="card_priv"
                        data-prompt="PrivEsc Vector (LinPEAS/WinPEAS):">‚¨ÜÔ∏è Privilege Escalation</div>
                    <div class="tactic-card" draggable="true" ondragstart="drag(event)" id="card_loot"
                        data-prompt="Loot Found (Hashes/Keys):">ÔøΩ Loot / Credentials</div>
                    <div class="tactic-card" draggable="true" ondragstart="drag(event)" id="card_note"
                        data-prompt="Field Note:">üìù Custom Note</div>
                </div>

                <!-- Main Canvas -->
                <div class="canvas-container">
                    <div class="kill-chain-phase" id="phase1_scope" ondrop="drop(event)" ondragover="allowDrop(event)">
                        <div class="phase-header">1. Scope & Recon</div>
                    </div>
                    <div class="kill-chain-phase" id="phase2_enum" ondrop="drop(event)" ondragover="allowDrop(event)">
                        <div class="phase-header">2. Enumeration</div>
                    </div>
                    <div class="kill-chain-phase" id="phase3_vuln" ondrop="drop(event)" ondragover="allowDrop(event)">
                        <div class="phase-header">3. Vuln Analysis</div>
                    </div>
                    <div class="kill-chain-phase" id="phase4_exploit" ondrop="drop(event)"
                        ondragover="allowDrop(event)">
                        <div class="phase-header">4. Exploitation</div>
                    </div>
                    <div class="kill-chain-phase" id="phase5_post" ondrop="drop(event)" ondragover="allowDrop(event)">
                        <div class="phase-header">5. Post-Exploitation</div>
                    </div>
                </div>

                <!-- Controls -->
                <div style="margin-top: 20px; text-align: right;">
                    <button class="nav-button" onclick="location.reload()">[ RESET LOG ]</button>
                    <button class="nav-button" onclick="generateReport()"
                        style="border-color: #00ff41; color: #00ff41;">[ GENERATE ENGAGEMENT REPORT ]</button>
                </div>

                <!-- Report Area -->
                <div id="report" class="report-output"></div>

            </div>
        </div>
    </main>

    <script src="../js/scripts.js"></script>
    <script>
        // Drag and Drop Logic
        let cardCounter = 0; // Ensure unique IDs for cloned cards

        function allowDrop(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.add('drag-over');
        }

        function drag(ev) {
            ev.dataTransfer.setData("text", ev.target.id);
            ev.dataTransfer.setData("prompt", ev.target.getAttribute('data-prompt'));
        }

        function drop(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.remove('drag-over');

            // Identify drop target phase
            let phase = ev.target;
            while (phase && !phase.classList.contains('kill-chain-phase') && !phase.classList.contains('toolbox-area')) {
                phase = phase.parentNode;
            }

            if (!phase) return;

            // Logic: Is this a "Move" or a "New Copy"?
            // If dropping back to toolbox -> Delete logic or just ignore if it's the original.
            // Requirement said "drag the url", implying moving or copying. 
            // Better UX for a "Notebook": Dragging from Toolbox CREATES a new entry. Dragging between phases MOVES it.

            var data = ev.dataTransfer.getData("text");
            var originalElement = document.getElementById(data);

            if (phase.classList.contains('toolbox-area')) {
                // If dropping into toolbox, delete if it's a clone (notebook entry)
                if (originalElement && originalElement.hasAttribute('data-cloned')) {
                    originalElement.remove();
                }
                return;
            }

            // If we are dropping into a Phase
            let targetCard;

            if (originalElement && !originalElement.hasAttribute('data-cloned')) {
                // It's a fresh drag from the toolbox. CLONE IT.
                targetCard = originalElement.cloneNode(true);
                cardCounter++;
                targetCard.id = "note_" + cardCounter;
                targetCard.setAttribute('data-cloned', 'true');

                // Prompt for input
                let promptText = originalElement.getAttribute('data-prompt') || "Enter details:";
                let userInput = prompt(promptText);

                if (userInput === null) return; // Cancelled

                // Append details
                targetCard.innerHTML += `<div style="color: #00ff41; font-size: 0.85rem; margin-top: 5px; border-top: 1px solid #444; padding-top: 4px; overflow-wrap: break-word;" contenteditable="true">${userInput}</div>`;

                // Add a delete button
                let delBtn = document.createElement('span');
                delBtn.innerHTML = " &times;";
                delBtn.style.color = 'red';
                delBtn.style.cursor = 'pointer';
                delBtn.style.float = 'right';
                delBtn.onclick = function () { this.parentNode.remove(); };
                targetCard.prepend(delBtn);

                phase.appendChild(targetCard);

            } else if (originalElement) {
                // It's already a note, just moving it to another phase
                phase.appendChild(originalElement);
            }
        }

        // Remove drag-over styling when leaving
        document.querySelectorAll('.kill-chain-phase, .toolbox-area').forEach(el => {
            el.addEventListener('dragleave', (e) => {
                e.currentTarget.classList.remove('drag-over');
            });
        });

        function generateReport() {
            const phases = [
                'phase1_scope', 'phase2_enum', 'phase3_vuln', 'phase4_exploit',
                'phase5_post'
            ];

            let reportText = ">>> PENTEST ENGAGEMENT LOG <<<\n";
            reportText += "DATE: " + new Date().toLocaleString() + "\n";
            reportText += "OPERATIVE: DMICHOS\n";
            reportText += "STATUS: CONFIDENTIAL\n----------------------------------\n\n";

            phases.forEach((phaseId, index) => {
                const phaseEl = document.getElementById(phaseId);
                const cards = phaseEl.querySelectorAll('.tactic-card');
                const phaseName = phaseEl.querySelector('.phase-header').innerText;

                if (cards.length > 0) {
                    reportText += `[PHASE ${index + 1}: ${phaseName}]\n`;
                    cards.forEach(card => {
                        // Extract Title and Content
                        // Clone structure: [X] [Text] [Div details]
                        // Simple parse:
                        let cleanTitle = card.innerText.split("\n")[0].replace("√ó", "").trim();
                        let details = card.querySelector('div') ? card.querySelector('div').innerText : "(No details)";

                        reportText += `  > ${cleanTitle}\n`;
                        reportText += `    NOTE: ${details}\n`;
                    });
                    reportText += "\n";
                }
            });

            reportText += "----------------------------------\n";
            reportText += "[END OF LOG]";

            const reportDiv = document.getElementById('report');
            reportDiv.innerText = reportText;
            reportDiv.style.display = 'block';
            reportDiv.scrollIntoView({ behavior: 'smooth' });
        }
    </script>

</body>

</html>
